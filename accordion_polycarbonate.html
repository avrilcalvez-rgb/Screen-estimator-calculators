<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Polycarbonate Accordion Calculator — V9</title>
  <style>
    :root{
      --bg:#fff7ed; --panel:#ffffff; --border:#fed7aa;
      --ink:#2e2a23; --muted:#6b6157; --accent:#f97316;
      --accent-weak:#ffedd5; --accent-strong:#ea580c;
      --hi:#fff3cd; --hi-border:#ffe08a; --disabled:#f5f5f4;
    }
    *{box-sizing:border-box}
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background-color: var(--bg); margin: 20px; color:var(--ink) }
    h1 { margin:0 0 12px; color:var(--accent-strong); font-size:20px }
    h2 { margin: 0 0 10px; font-size: 15px; }
    .container { max-width: 1220px; margin: auto; display: grid; grid-template-columns: 460px 1fr; gap: 14px; }
    .card { background: var(--panel); border: 1px solid var(--border); border-radius: 14px; padding: 14px; }
    label { display:block; margin-top:8px; font-size:12px; color:var(--muted)}
    input, select, textarea { width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border); margin-top:6px; background:white }
    .row{ margin-bottom:8px }
    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px }
    .btns{ display:flex; gap:8px; margin-top:10px }
    button{ padding:10px 12px; border-radius:10px; border:1px solid var(--border); background:white; cursor:pointer }
    button.primary{ background:var(--accent); color:white; border-color:var(--accent); font-weight:700 }
    table{ width:100%; border-collapse: collapse; font-size:13px; background:white }
    th,td{ border-bottom:1px solid var(--border); padding:6px 6px; text-align:left }
    th{ background:var(--accent-weak); color:var(--muted) }
    .right{text-align:right}
    .mono{ font-family: ui-monospace,SFMono-Regular,Menlo,Consolas,monospace }
    .title-line{ font-weight:900; font-size:20px; text-align:center; margin: 4px 0 10px; color:var(--accent-strong) }
    .small{ font-size:12px; color:var(--muted) }
    .pill{ display:inline-block; padding:2px 8px; border:1px solid var(--border); border-radius:9999px; background:var(--accent-weak); font-size:12px; color:var(--muted) }
    .hidden{ display:none !important }
    .headerbar{ display:flex; align-items:center; justify-content:space-between; background:linear-gradient(90deg,var(--accent-weak),#fff); border:1px solid var(--border); border-radius:14px; padding:10px 14px; margin-bottom:14px }
    .hi-box{ background:var(--hi); border:1px solid var(--hi-border); border-radius:10px; padding:10px 12px; font-weight:700; display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap }
    .subpill{ font-weight:600; padding:4px 8px; border-radius:8px; background:#fff; border:1px dashed var(--hi-border) }
  
    /* Yellow badge for highlighted outputs (Notes/Powdercoat) */
    .note-badge{
      display:inline-block;
      background: var(--hi);
      border: 1px solid var(--hi-border);
      border-radius: 8px;
      padding: 2px 6px;
      font-weight: 700;
      color: var(--ink);
    }
  </style>
</head>
<body>
  <div class="headerbar">
    <h1 id="header_title">POLYCARBONATE ACCORDION — ONE WAY</h1>
    <button class="primary" onclick="window.print()">Print / Screenshot</button>
  </div>

  <div class="container">
    <!-- Inputs -->
    <section class="card">
      <h2>Inputs</h2>

      <div class="grid2">
        <div class="row">
          <label for="mode">Type</label>
          <select id="mode">
            <option value="one">Polycarbonate One Way</option>
            <option value="two">Polycarbonate Two Way</option>
          </select>
        </div>
        <div class="row">
          <label for="direction">Direction</label>
          <select id="direction">
            <option>Left to Right</option>
            <option>Right to Left</option>
            <option disabled>Two Way</option>
          </select>
          <div class="small" id="dir_hint">For One Way, choose direction. For Two Way, this becomes fixed.</div>
        </div>
      </div>

      <div class="grid2">
        <div class="row">
          <label for="wmm">Width (mm)</label>
          <input id="wmm" type="number" step="1" value="2350">
          <div class="small">Tip: Copy <b>Width + Height</b> (2 cells) from Excel, click here, then <b>Paste</b>.</div>
        </div>
        <div class="row">
          <label for="hmm">Height (mm)</label>
          <input id="hmm" type="number" step="1" value="2310">
        </div>
      </div>

      <div class="grid2">
        <div class="row">
          <label for="panel_color">Panel Color</label>
          <select id="panel_color">
            <option>Transparent</option>
            <option>Frosted</option>
          </select>
        </div>
        <div class="row">
          <label for="powder">Powdercoat</label>
          <input id="powder" placeholder="e.g., PWD12345 (leave blank if none)">
        </div>
      </div>

      <div class="grid2">
        <div class="row">
          <label for="purpose">Purpose</label>
          <select id="purpose">
            <option>For CR</option>
            <option>For Inside Devider</option>
            <option>For Outdoor</option>
          </select>
        </div>
        <div class="row">
          <label for="branch">Branch</label>
          <select id="branch">
            <option>Batangas Client</option>
            <option>Pampanga Branch</option>
            <option>Shipping Thru AP Cargo</option>
            <option>Shipping Thru Victory Drop & Go</option>
          </select>
        </div>
      </div>

      <div class="row">
        <label for="client">Client</label>
        <input id="client" placeholder="Client name">
      </div>

      <div class="row">
        <label for="status">Status</label>
        <select id="status">
          <option>New</option>
          <option>Repair</option>
          <option>Warranty</option>
        </select>
      </div>
      <div class="row">
        <label for="notes">Notes</label>
        <textarea id="notes" rows="2" placeholder="Add job notes here..."></textarea>
      </div>
    

      <h2>Formula‑168 Constants (match your sheet)</h2>
      <div class="grid2">
        <div class="row">
          <label for="add_pcs">Add pcs (J36)</label>
          <input id="add_pcs" type="number" step="1" value="2">
        </div>
        <div class="row">
          <label for="step_mm">Step (mm) (J35)</label>
          <input id="step_mm" type="number" step="1" value="95">
        </div>
      </div>
      <div class="grid2">
        <div class="row">
          <label for="offset_one">Offset One Way (mm)</label>
          <input id="offset_one" type="number" step="1" value="70">
        </div>
        <div class="row">
          <label for="offset_two">Offset Two Way (mm)</label>
          <input id="offset_two" type="number" step="1" value="110">
        </div>
      </div>

      <div class="btns">
        <button class="primary" onclick="window.print()">Print / Screenshot</button>
      </div>
    </section>

    <!-- Outputs -->
    <section class="card">
      <div class="title-line" id="title_line">POLYCARBONATE ACCORDION — ONE WAY</div>

      <div class="grid2">
        <div class="card" style="padding:10px">
          <div><strong>Client:</strong> <span id="o_client" class="mono">—</span></div>
          <div><strong>Panel Color:</strong> <span id="o_color" class="mono">—</span></div>
          <div><strong>Powdercoat:</strong> <span id="o_powder" class="mono">No</span></div>
          <div><strong>Purpose:</strong> <span id="o_purpose" class="mono">—</span></div>
        </div>
        <div class="card" style="padding:10px">
          <div><strong>Branch:</strong> <span id="o_branch" class="mono">—</span></div>
          <div><strong>Size (W×H):</strong> <span id="o_size" class="mono">—</span></div>
          <div><strong>Direction:</strong> <span id="o_dir" class="mono">—</span></div>
          <div><strong>Status:</strong> <span id="o_status" class="mono">—</span></div>
          <div><strong>Notes:</strong> <span id="o_notes" class="mono">—</span></div>
        </div>
      </div>

      <h2 style="margin-top:12px" id="panel_qty_header">Transparent Panel Quantity</h2>
      <div class="hi-box">
        <div id="panel_qty_label">Transparent Panel Quantity (single opening)</div>
        <div class="mono" id="o_qty_total">—</div>
        <div class="subpill hidden" id="each_side_box">Left: <span class="mono" id="o_left">—</span> | Right: <span class="mono" id="o_right">—</span></div>
      </div>

      <h2 style="margin-top:12px">CUTTINGS (mm)</h2>
      <table>
        <thead><tr><th>Material</th><th class="right">Length (mm)</th></tr></thead>
        <tbody>
          <tr><td>Side frame</td><td class="right mono" id="len_side">—</td></tr>
          <tr><td>Sliding rod</td><td class="right mono" id="len_slide">—</td></tr>
          <tr><td>Upper frame</td><td class="right mono" id="len_upper">—</td></tr>
          <tr><td>Bottom frame</td><td class="right mono" id="len_bottom">—</td></tr>
          <tr><td>Panel cutting</td><td class="right mono" id="len_panel">—</td></tr>
        </tbody>
      </table>

      <div class="card" style="margin-top:10px; padding:10px; background:var(--accent-weak)">
        <div class="small"><b>Note:</b> One Way panel qty is forced even (adds +1 if odd). Two Way follows your sheet (per side = CEILING(total/2)).</div>
      </div>
    </section>
  </div>

<script>
  const $ = id => document.getElementById(id);

  function updateHeaderAndDirection(){
    const mode = $('mode').value;
    const dir = $('direction');
    const header_title = $('header_title');
    const title_line = $('title_line');
    if(mode === 'two'){
      header_title.textContent = 'POLYCARBONATE ACCORDION — TWO WAY';
      title_line.textContent   = 'POLYCARBONATE ACCORDION — TWO WAY';
      dir.value = 'Two Way';
      dir.options[2].disabled = false;
      dir.disabled = true;
      $('o_dir').textContent = 'Two Way';
      $('dir_hint').textContent = 'Two Way selected — direction fixed.';
    }else{
      header_title.textContent = 'POLYCARBONATE ACCORDION — ONE WAY';
      title_line.textContent   = 'POLYCARBONATE ACCORDION — ONE WAY';
      dir.disabled = false;
      dir.options[2].disabled = true;
      if(dir.value === 'Two Way'){ dir.value = 'Left to Right'; }
      $('dir_hint').textContent = 'For One Way, choose direction.';
    }
  }

  function updatePanelQtyLabels(){
    const color = $('panel_color').value || 'Transparent';
    const opening = ($('mode').value === 'two') ? 'double opening' : 'single opening';
    const title = `${color} Panel Quantity`;
    $('panel_qty_header').textContent = title;
    $('panel_qty_label').textContent  = `${title} (${opening})`;
  }

  function ceil(n){ return Math.ceil(n); }

  function compute(){
    updateHeaderAndDirection();
    updatePanelQtyLabels();

    const w = +$('wmm').value || 0;
    const h = +$('hmm').value || 0;
    const mode = $('mode').value;

    // Formula-168 constants
    const add_pcs = +$('add_pcs').value || 0;
    const offset  = (mode === 'two') ? (+$('offset_two').value || 0) : (+$('offset_one').value || 0);
    const step    = +$('step_mm').value || 1;

    // Auto-calculate panel quantity
    let qtyTotal = ceil(((w - offset) / step) * add_pcs);

    // Enforce: One Way total must be even
    if(mode === 'one' && qtyTotal % 2 === 1){
      qtyTotal += 1;
    }

    // Per side — Two Way: each side must also be even
    let perSide = ceil(qtyTotal / 2);
    if(mode === 'two' && perSide % 2 === 1){
      perSide += 1; // add 1 to each side to make it even
      qtyTotal = perSide * 2; // update total accordingly
    }

    $('o_qty_total').textContent = qtyTotal;

    const eachBox = $('each_side_box');
    if(mode === 'two'){
      eachBox.classList.remove('hidden');
      $('o_left').textContent  = perSide;
      $('o_right').textContent = perSide;
    }else{
      eachBox.classList.add('hidden');
      $('o_left').textContent  = '—';
      $('o_right').textContent = '—';
    }

    // Meta
    $('o_color').textContent = $('panel_color').value;
    const powder = $('powder').value.trim();
    $('o_powder').textContent = powder ? `Yes (${powder})` : 'No';
    (function(o){ if(!o) return; o.className = powder ? 'mono note-badge' : 'mono'; })($('o_powder'));
    $('o_purpose').textContent = $('purpose').value;
    $('o_branch').textContent  = $('branch').value;
    $('o_size').textContent    = `${w} × ${h}`;
    $('o_status').textContent  = $('status').value;
    $('o_client').textContent  = $('client').value || '—';

    // Notes live output + highlight
    const notes = ($('notes') && $('notes').value) ? $('notes').value : '';
    $('o_notes').textContent = (notes || '').trim() || '—';
    (function(o){ if(!o) return; o.className = (notes && notes.trim()) ? 'mono note-badge' : 'mono'; })($('o_notes'));
    $('o_dir').textContent     = $('direction').value;

    // Hidden deduction logic
    const side_ded = 7, slide_ded = 61, tb_ded = 40, panel_ded = 73;
    if(!w || !h){
      ['len_side','len_slide','len_upper','len_bottom','len_panel'].forEach(id => $(id).textContent='—');
      return;
    }
    $('len_side').textContent  = h - side_ded;
    $('len_slide').textContent = h - slide_ded;
    $('len_upper').textContent = w - tb_ded;
    $('len_bottom').textContent= w - tb_ded;
    $('len_panel').textContent = h - panel_ded;
  }

  const ids = ['mode','direction','wmm','hmm','panel_color','powder','purpose','branch','client','status','add_pcs','offset_one','offset_two','step_mm','notes'];
  ids.forEach(id => {
    const el = $(id);
    const evt = (el.tagName === 'SELECT') ? 'change' : 'input';
    el.addEventListener(evt, compute);
  });

  function parseExcelNumbers(text){
    const matches = text.match(/-?\d{1,3}(?:,\d{3})*(?:\.\d+)?/g);
    if(!matches) return [];
    return matches.map(s => parseFloat(s.replace(/,/g,''))).filter(n => !Number.isNaN(n));
  }
  function handlePasteBoth(e){
    const txt = (e.clipboardData || window.clipboardData).getData('text');
    if(!txt) return;
    const nums = parseExcelNumbers(txt);
    if(nums.length >= 2){
      // Only auto-fill both fields if 2+ numbers are pasted (e.g. copied two cells from Excel)
      e.preventDefault();
      $('wmm').value = nums[0];
      $('hmm').value = nums[1];
      compute();
    }
    // If only 1 number, let it paste normally into whichever field was clicked
  }
  ['wmm','hmm'].forEach(id => $(id).addEventListener('paste', handlePasteBoth));

  window.addEventListener('DOMContentLoaded', compute);
</script>

</body>
</html>
