<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pleated Screen Calculator ‚Äî v10</title>
<style>
:root{--bg:#0F172A;--panel:#111827;--ink:#E5E7EB;--muted:#94A3B8;--border:#1F2937;--accent:#38BDF8}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
header{padding:12px 18px;background:var(--panel);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
header h1{margin:0;font-size:15px;font-weight:700}
.hdr-btns{display:flex;gap:8px;align-items:center}
.wrap{max-width:1200px;margin:16px auto 24px;padding:0 14px;display:grid;grid-template-columns:380px 1fr;gap:14px}
.card{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:14px}
h2{margin:0 0 10px;font-size:15px}
label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
input,select,textarea{width:100%;background:#0B1220;color:var(--ink);border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-size:14px}
textarea{min-height:64px}
.row{display:grid;grid-template-columns:150px 1fr;gap:10px;align-items:center;margin-bottom:10px}
.btns{display:flex;gap:8px;margin-top:6px}
button{border:1px solid var(--border);background:#0B1220;color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer;font-size:13px}
button.primary{background:var(--accent);color:#0B1220;border-color:var(--accent);font-weight:700}
button.danger{background:#7f1d1d;color:#fca5a5;border-color:#7f1d1d}
.title-line{font-weight:900;font-size:20px;text-align:center;margin:6px 0 10px;letter-spacing:.4px}
.meta-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px}
.meta-block{padding:8px;border:1px solid var(--border);border-radius:10px;background:#0B1220;font-size:13px}
.meta-block .row-line{display:flex;justify-content:space-between;margin:3px 0}
table{width:100%;border-collapse:collapse;font-size:13px;line-height:1.2}
th,td{border-bottom:1px solid var(--border);padding:6px 6px;text-align:left}
th{color:var(--muted);background:#0B1322}
.right{text-align:right;text-align:right}
.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
.section{margin-top:8px}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media print{header,.no-print{display:none!important}body{background:white;color:black}.wrap{grid-template-columns:1fr 1fr;gap:10px;margin:0 auto}.card{break-inside:avoid}th,td{padding:5px 5px}}
/* highlights */
.pc-on{background:#fff7a3!important;border-color:#facc15!important;outline:2px solid #facc15!important;box-shadow:0 0 0 3px rgba(250,204,21,.55) inset;color-scheme:light;color:#111!important;caret-color:#111!important}
.pc-row-on label{color:#111!important}
.pc-badge{display:inline-block;background:#fff7a3;border:1px solid #fde047;border-radius:8px;padding:2px 6px;font-weight:700;color:#111!important}
.note-on{background:#fef3c7!important;border-color:#f59e0b!important;outline:2px solid #f59e0b!important;box-shadow:0 0 0 3px rgba(245,158,11,.35) inset}
.note-row-on{background:rgba(245,158,11,.12);border-radius:10px}
.note-badge{display:inline-block;background:#fef3c7;border:1px solid #f59e0b;border-radius:8px;padding:2px 6px;font-weight:700;color:#111}
/* stock match panel */
.stock-panel{margin-top:12px;border:1px solid #1e3a5f;border-radius:12px;overflow:hidden}
.stock-header{background:#0c2340;padding:8px 12px;display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
.stock-header h2{margin:0;font-size:14px;color:#7dd3fc}
.stock-badge{background:#1e40af;color:#bfdbfe;border-radius:999px;padding:2px 10px;font-size:12px;font-weight:700}
.stock-badge.none{background:#7f1d1d;color:#fca5a5}
.stock-badge.ok{background:#14532d;color:#86efac}
.stock-badge.alt{background:#78350f;color:#fde68a}
.need-row{background:#0f1f30;border-radius:8px;padding:6px 10px;font-size:12px;color:#7dd3fc;margin:8px 12px 4px}
.need-row span{color:#e2e8f0;font-weight:600}
.stock-table-wrap{max-height:260px;overflow-y:auto}
.stock-table{width:100%;border-collapse:collapse;font-size:12px}
.stock-table th{background:#0c2340;color:#7dd3fc;padding:5px 8px;position:sticky;top:0;z-index:1}
.stock-table td{padding:5px 8px;border-bottom:1px solid #1a2a3a}
.stock-table tr:hover td{background:#0a2035}
.match-exact{background:#052e16!important}.match-exact td{color:#86efac}
.match-alt-good{background:#1a2a10!important}.match-alt-good td{color:#bef264}
.match-alt-other{background:#1a1a2e!important}.match-alt-other td{color:#c4b5fd}
.no-match-msg{text-align:center;padding:18px;color:#64748b;font-size:13px}
.alt-msg{padding:7px 10px;color:#fde68a;font-size:11px;background:#1c1408;font-style:italic}
.surplus-chip{display:inline-block;font-size:10px;background:#1e3a5f;border-radius:4px;padding:1px 5px;color:#93c5fd;margin-left:3px}
.surplus-chip.alt-chip{background:#3b2a08;color:#fcd34d}
.btn-use{background:#166534;color:#bbf7d0;border:1px solid #166534;border-radius:6px;padding:2px 8px;font-size:11px;cursor:pointer;white-space:nowrap}
.btn-use:hover{background:#15803d}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:1000;display:flex;align-items:flex-start;justify-content:center;padding:20px;overflow-y:auto}
.modal-overlay.hidden{display:none}
.modal{background:#111827;border:1px solid #1F2937;border-radius:16px;width:100%;max-width:900px;display:flex;flex-direction:column;max-height:90vh}
.modal-head{padding:14px 18px;border-bottom:1px solid #1F2937;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-shrink:0}
.modal-head h2{margin:0;font-size:16px}
.modal-body{padding:14px 18px;overflow-y:auto;flex:1}
.modal-close{background:none;border:none;color:#94A3B8;font-size:20px;cursor:pointer;padding:4px 8px;line-height:1}
.modal-close:hover{color:#fff}
/* upload zone */
.upload-zone{border:2px dashed #1F2937;border-radius:12px;padding:28px;text-align:center;color:#64748b;cursor:pointer;transition:border-color .2s}
.upload-zone:hover,.upload-zone.drag{border-color:#38BDF8;color:#7dd3fc}
.upload-zone input[type=file]{display:none}
.upload-zone .icon{font-size:32px;margin-bottom:8px}
/* stock list table */
.sl-filters{display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap;align-items:center}
.sl-filters select,.sl-filters input{background:#0B1220;color:var(--ink);border:1px solid var(--border);border-radius:8px;padding:6px 10px;font-size:12px;width:auto}
.sl-filters label{font-size:12px;color:var(--muted);margin:0}
.sl-table-wrap{max-height:420px;overflow-y:auto;border:1px solid #1F2937;border-radius:10px}
.sl-table{width:100%;border-collapse:collapse;font-size:12px}
.sl-table th{background:#0B1322;color:#94A3B8;padding:7px 10px;position:sticky;top:0;z-index:1;font-weight:600}
.sl-table td{padding:6px 10px;border-bottom:1px solid #1a2030}
.sl-table tr.used-row td{color:#6b7280;background:#0d1117}
.sl-table tr.used-row td.status-cell{color:#ef4444}
.sl-table tr.avail-row td.status-cell{color:#22c55e}
.sl-table tr:hover td{background:#0f1a28}
.btn-toggle-use{border-radius:6px;padding:2px 8px;font-size:11px;cursor:pointer;white-space:nowrap;border:1px solid}
.btn-toggle-use.mark{background:#166534;color:#bbf7d0;border-color:#166534}
.btn-toggle-use.mark:hover{background:#15803d}
.btn-toggle-use.unmark{background:#3b1f1f;color:#fca5a5;border-color:#7f1d1d}
.btn-toggle-use.unmark:hover{background:#7f1d1d}
.stats-row{display:flex;gap:12px;margin-bottom:12px;flex-wrap:wrap}
.stat-box{background:#0B1220;border:1px solid #1F2937;border-radius:10px;padding:8px 14px;font-size:13px;min-width:90px;text-align:center}
.stat-box .stat-num{font-size:22px;font-weight:700;display:block}
.stat-box .stat-lbl{color:#64748b;font-size:11px}
.stat-total .stat-num{color:#38BDF8}
.stat-avail .stat-num{color:#22c55e}
.stat-used  .stat-num{color:#ef4444}
/* upload result */
.upload-result{background:#052e16;border:1px solid #166534;border-radius:10px;padding:10px 14px;margin-top:10px;font-size:13px;color:#86efac;display:none}
.upload-result.error{background:#3b1f1f;border-color:#7f1d1d;color:#fca5a5}
/* no stock banner */
.no-stock-banner{background:#0c2340;border:1px dashed #1e3a5f;border-radius:10px;padding:14px;text-align:center;color:#7dd3fc;font-size:13px;margin-bottom:12px}
.no-stock-banner button{margin-top:8px;background:#1e40af;color:#bfdbfe;border:none;padding:6px 14px;border-radius:8px;cursor:pointer;font-size:12px}
</style>
</head>
<body>

<header>
  <h1>üìê Pleated Screen ‚Äî Calculator (v10)</h1>
  <div class="hdr-btns no-print">
    <button onclick="openStockModal()" style="background:#0c2340;color:#7dd3fc;border-color:#1e3a5f">üì¶ Stock List</button>
    <button onclick="window.print()">üñ® Print</button>
  </div>
</header>

<!-- ‚ïê‚ïê STOCK LIST MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay hidden" id="modal_overlay">
  <div class="modal">
    <div class="modal-head">
      <h2>üì¶ Stock List</h2>
      <div style="display:flex;gap:8px;align-items:center">
        <button onclick="triggerUpload()" style="background:#1e40af;color:#bfdbfe;border-color:#1e40af;font-size:12px;padding:6px 12px">‚¨Ü Upload New Excel</button>
        <button class="modal-close" onclick="closeStockModal()">‚úï</button>
      </div>
    </div>
    <div class="modal-body">

      <!-- Upload zone (shown when no stock loaded) -->
      <div id="upload_section">
        <div class="upload-zone" id="upload_zone" onclick="triggerUpload()" ondragover="dragOver(event)" ondragleave="dragLeave(event)" ondrop="dropFile(event)">
          <input type="file" id="file_input" accept=".xlsx,.xls" onchange="handleFile(event)">
          <div class="icon">üìä</div>
          <div style="font-size:14px;margin-bottom:4px">Drop your Excel stock file here or click to browse</div>
          <div style="font-size:12px">Supports .xlsx ‚Äî expects columns: Box, Fold, Height/Width, Color</div>
          <div style="font-size:11px;margin-top:6px;color:#475569">The same Excel you already have (mesh_inventory.xlsx) works perfectly</div>
        </div>
        <div class="upload-result" id="upload_result"></div>
      </div>

      <!-- Stats -->
      <div class="stats-row" id="stats_row" style="display:none">
        <div class="stat-box stat-total"><span class="stat-num" id="stat_total">0</span><span class="stat-lbl">Total</span></div>
        <div class="stat-box stat-avail"><span class="stat-num" id="stat_avail">0</span><span class="stat-lbl">Available</span></div>
        <div class="stat-box stat-used"><span class="stat-num" id="stat_used">0</span><span class="stat-lbl">Used</span></div>
      </div>

      <!-- Filters -->
      <div class="sl-filters" id="sl_filters" style="display:none">
        <label>Color:</label>
        <select id="sl_color" onchange="renderStockList()">
          <option value="">All</option>
          <option value="Black">Black</option>
          <option value="Gray">Gray</option>
          <option value="Black Mesh">Black Mesh</option>
        </select>
        <label>Status:</label>
        <select id="sl_status" onchange="renderStockList()">
          <option value="">All</option>
          <option value="available">Available</option>
          <option value="used">Used</option>
        </select>
        <label>Box:</label>
        <select id="sl_box" onchange="renderStockList()">
          <option value="">All</option>
        </select>
        <input id="sl_search" type="text" placeholder="Search‚Ä¶" oninput="renderStockList()" style="width:120px">
        <button onclick="markAllFilteredUsed()" class="danger" style="font-size:11px;padding:4px 10px">Mark filtered as used</button>
        <button onclick="clearAllUsed()" style="font-size:11px;padding:4px 10px;background:#1e3a5f;color:#93c5fd;border-color:#1e3a5f">‚Ü© Clear all used</button>
      </div>

      <!-- Table -->
      <div class="sl-table-wrap" id="sl_table_wrap" style="display:none">
        <table class="sl-table">
          <thead><tr>
            <th>#</th><th>Box</th><th>Color</th><th>Dim Type</th>
            <th class="right">Fold</th><th class="right">H / W (cm)</th>
            <th>Status</th><th>Action</th>
          </tr></thead>
          <tbody id="sl_tbody"></tbody>
        </table>
      </div>

      <!-- No stock yet -->
      <div class="no-stock-banner" id="no_stock_banner" style="display:none">
        No stock loaded yet. Upload your Excel file above to get started.
      </div>

    </div>
  </div>
</div>
<!-- ‚ïê‚ïê END MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<div class="wrap">
  <!-- LEFT: Inputs -->
  <section class="card">
    <h2>Inputs</h2>
    <div class="row"><label>Direction</label>
      <select id="direction"><option>One Way</option><option>Two Way</option></select>
    </div>
    <div class="row"><label>Width (mm)</label><input id="width_mm" type="number" min="1" step="1" value="760"></div>
    <div class="row"><label>Height (mm)</label><input id="height_mm" type="number" min="1" step="1" value="2090"></div>
    <div class="row"><label>Mesh Color</label>
      <select id="mesh_color"><option>Black</option><option>Gray</option></select>
    </div>
    <div class="row"><label>Accessories Color</label>
      <select id="acc_color"><option>White</option><option>Black</option></select>
    </div>
    <div class="row"><label>Job Type</label>
      <select id="replacement"><option value="new">New (Complete)</option><option value="repair">Repair (Mesh Only)</option></select>
    </div>
    <div class="row"><label>Powdercoat Code</label><input id="powder_code" placeholder="e.g., A1533"></div>
    <div class="row"><label>Client</label><input id="client" placeholder="Client name"></div>
    <div class="row"><label>Branch</label>
      <select id="branch">
        <option>Batangas Branch</option><option>Pampanga Branch</option>
        <option>Shipping Thru AP Cargo</option><option>Shipping Thru Victory Drop & Go</option>
      </select>
    </div>
    <div class="row"><label>Notes</label><textarea id="notes" placeholder="Optional notes‚Ä¶"></textarea></div>
    <div class="btns no-print">
      <button id="compute_btn">Compute</button>
      <button class="primary" onclick="window.print()">Print</button>
    </div>
  </section>

  <!-- RIGHT: Outputs -->
  <section class="card">
    <div id="big_mode_header" class="title-line">ONE WAY PLEATED SCREEN</div>
    <div class="meta-grid">
      <div class="meta-block">
        <div class="row-line"><span>Client:</span><span id="out_client" class="mono">‚Äî</span></div>
        <div class="row-line"><span>Mesh:</span><span id="out_mesh_color" class="mono">‚Äî</span></div>
        <div class="row-line"><span>Accessories:</span><span id="out_accessories" class="mono">‚Äî</span></div>
        <div class="row-line"><span>Powdercoat:</span><span id="out_powder" class="mono">No</span></div>
        <div class="row-line"><span>Notes:</span><span id="out_notes" class="mono">‚Äî</span></div>
      </div>
      <div class="meta-block">
        <div class="row-line"><span>Size (W√óH):</span><span id="out_size" class="mono">‚Äî</span></div>
        <div class="row-line"><span>Branch:</span><span id="out_branch" class="mono">‚Äî</span></div>
      </div>
    </div>

    <div class="section">
      <div id="cuttings_block">
        <h2>Aluminum cuttings (mm)</h2>
        <table>
          <thead><tr><th>Material</th><th class="right">Qty</th><th class="right">Length (mm)</th></tr></thead>
          <tbody>
            <tr><td>Side frame (X023)</td><td class="right mono">x2</td><td class="right mono" id="len_side_frame">‚Äî</td></tr>
            <tr><td>Top profile (X022)</td><td class="right mono">x1</td><td class="right mono" id="len_top_profile">‚Äî</td></tr>
            <tr><td>PVC</td><td class="right mono">x1</td><td class="right mono" id="len_pvc">‚Äî</td></tr>
            <tr><td>Bottom profile (X023)</td><td class="right mono">x1</td><td class="right mono" id="len_bottom_profile">‚Äî</td></tr>
            <tr><td>Inner frame (X024)</td><td class="right mono">x2</td><td class="right mono" id="len_inner_frame">‚Äî</td></tr>
            <tr><td>Middle profile (X025)</td><td class="right mono">x1</td><td class="right mono" id="len_middle_profile">‚Äî</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="section two-col">
      <div>
        <h2>Mesh Details</h2>
        <table>
          <thead><tr><th>Item</th><th>Color</th><th class="right">Value</th></tr></thead>
          <tbody>
            <tr><td>mesh(H)</td><td id="mesh_color_cell">‚Äî</td><td class="right mono" id="mesh_h_value">‚Äî</td></tr>
            <tr id="mesh_fold_total_row"><td>mesh(fold)</td><td>‚Äî</td><td class="right mono" id="mesh_fold_value">‚Äî</td></tr>
            <tr id="mesh_fold_per_leaf_row" style="display:none"><td>fold per leaf</td><td>‚Äî</td><td class="right mono" id="mesh_fold_per_leaf_value">‚Äî</td></tr>
            <tr id="mesh_fold_left_row" style="display:none"><td>fold left</td><td>‚Äî</td><td class="right mono" id="mesh_fold_left_value">‚Äî</td></tr>
            <tr id="mesh_fold_right_row" style="display:none"><td>fold right</td><td>‚Äî</td><td class="right mono" id="mesh_fold_right_value">‚Äî</td></tr>
          </tbody>
        </table>
      </div>
      <div>
        <h2>Hold Distances</h2>
        <table>
          <thead><tr><th>Seq</th><th class="right">Distance (mm)</th></tr></thead>
          <tbody id="holes_table"></tbody>
        </table>
      </div>
    </div>

    <div class="section">
      <h2>Rope Sizes</h2>
      <table>
        <thead><tr><th>#</th><th class="right">Size (mm)</th><th class="right">pc</th></tr></thead>
        <tbody id="rope_table"></tbody>
      </table>
    </div>

    <!-- Stock Match Panel -->
    <div class="stock-panel no-print" id="stock_panel">
      <div class="stock-header">
        <h2>üì¶ Stock Match</h2>
        <span class="stock-badge" id="stock_badge">‚Äî</span>
      </div>
      <div class="need-row" id="need_row">Enter width & height to see matches</div>
      <div class="stock-table-wrap">
        <table class="stock-table">
          <thead><tr>
            <th>Box</th><th>Color</th>
            <th class="right">Fold</th><th class="right">H (cm)</th>
            <th class="right">+Fold</th><th class="right">+H (cm)</th>
            <th>Fit</th><th>Action</th>
          </tr></thead>
          <tbody id="stock_tbody"></tbody>
        </table>
      </div>
    </div>

  </section>
</div><!-- end .wrap -->

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EMBEDDED FALLBACK STOCK (from your existing Excel)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var BUILTIN_STOCK = [{"box":"Box 1","fold":69.0,"dim":77.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":120.0,"dim":98.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":32.0,"dim":115.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":52.0,"dim":53.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":59.0,"dim":96.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":85.0,"dim":101.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":42.0,"dim":85.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":32.0,"dim":95.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":39.0,"dim":134.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":34.0,"dim":41.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":43.0,"dim":103.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":42.0,"dim":94.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":15.0,"dim":93.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":39.0,"dim":93.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":24.0,"dim":188.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":64.0,"dim":95.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":28.0,"dim":77.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":35.0,"dim":94.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":42.0,"dim":72.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":91.0,"dim":100.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":81.0,"dim":107.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":45.0,"dim":97.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":75.0,"dim":80.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":26.0,"dim":210.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":68.0,"dim":74.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":30.0,"dim":75.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":50.0,"dim":91.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":36.0,"dim":141.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":53.0,"dim":133.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":22.0,"dim":132.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":25.0,"dim":64.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":58.0,"dim":124.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":53.0,"dim":124.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":44.0,"dim":95.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":60.0,"dim":82.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":61.0,"dim":95.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":48.0,"dim":88.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":91.0,"dim":93.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":34.0,"dim":300.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":50.0,"dim":78.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":58.0,"dim":41.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":28.0,"dim":149.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":52.0,"dim":40.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":45.0,"dim":93.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":96.0,"dim":40.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":65.0,"dim":99.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":50.0,"dim":99.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":44.0,"dim":95.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":110.0,"dim":105.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":61.0,"dim":56.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":45.0,"dim":95.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":61.0,"dim":71.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":75.0,"dim":80.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":31.0,"dim":75.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":43.0,"dim":62.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":40.0,"dim":300.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":31.0,"dim":51.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":27.0,"dim":59.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":31.0,"dim":88.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":34.0,"dim":115.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":55.0,"dim":78.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":49.0,"dim":84.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":161.0,"dim":81.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":47.0,"dim":64.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":77.0,"dim":99.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":46.0,"dim":74.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":89.0,"dim":77.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":30.0,"dim":93.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":48.0,"dim":66.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":40.0,"dim":153.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":89.0,"dim":71.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":38.0,"dim":91.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":92.0,"dim":65.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":55.0,"dim":68.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":52.0,"dim":54.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":22.0,"dim":72.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":53.0,"dim":82.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":39.0,"dim":300.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":43.0,"dim":61.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":58.0,"dim":110.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":62.0,"dim":91.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":85.0,"dim":99.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":37.0,"dim":114.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":46.0,"dim":106.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":48.0,"dim":101.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":38.0,"dim":100.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":32.0,"dim":200.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":27.0,"dim":82.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":40.0,"dim":88.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":38.0,"dim":103.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":53.0,"dim":90.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":66.0,"dim":94.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":51.0,"dim":101.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":47.0,"dim":96.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":41.0,"dim":91.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":31.0,"dim":84.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":30.0,"dim":94.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":38.0,"dim":103.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":24.0,"dim":74.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":85.0,"dim":98.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":43.0,"dim":95.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":40.0,"dim":105.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":33.0,"dim":96.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":101.0,"dim":74.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":43.0,"dim":77.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":87.0,"dim":90.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":15.0,"dim":101.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":34.0,"dim":87.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":39.0,"dim":90.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":41.0,"dim":65.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":74.0,"dim":50.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":60.0,"dim":102.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":38.0,"dim":103.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":54.0,"dim":91.0,"dt":"W","color":"Gray"},{"box":"Box 1","fold":76.0,"dim":188.0,"dt":"W","color":"Gray"},{"box":"Box 2","fold":42.0,"dim":92.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":41.0,"dim":75.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":60.0,"dim":48.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":88.0,"dim":80.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":41.0,"dim":99.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":33.0,"dim":87.3,"dt":"H","color":"Gray"},{"box":"Box 2","fold":58.0,"dim":89.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":38.0,"dim":116.7,"dt":"H","color":"Gray"},{"box":"Box 2","fold":50.0,"dim":101.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":44.0,"dim":95.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":30.0,"dim":99.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":81.0,"dim":99.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":117.0,"dim":112.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":111.0,"dim":96.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":78.0,"dim":141.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":58.0,"dim":84.9,"dt":"H","color":"Gray"},{"box":"Box 2","fold":92.0,"dim":68.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":61.0,"dim":102.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":89.0,"dim":113.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":94.0,"dim":50.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":70.0,"dim":60.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":42.0,"dim":68.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":66.0,"dim":176.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":41.0,"dim":70.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":49.0,"dim":70.2,"dt":"H","color":"Gray"},{"box":"Box 2","fold":37.0,"dim":93.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":51.0,"dim":79.8,"dt":"H","color":"Gray"},{"box":"Box 2","fold":46.0,"dim":91.6,"dt":"H","color":"Gray"},{"box":"Box 2","fold":51.0,"dim":95.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":43.0,"dim":93.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":64.0,"dim":68.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":42.0,"dim":93.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":47.0,"dim":89.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":56.0,"dim":81.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":41.0,"dim":77.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":38.0,"dim":89.7,"dt":"H","color":"Gray"},{"box":"Box 2","fold":79.0,"dim":77.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":42.0,"dim":78.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":38.0,"dim":99.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":31.0,"dim":105.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":51.0,"dim":65.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":37.0,"dim":103.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":27.0,"dim":80.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":38.0,"dim":99.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":41.0,"dim":65.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":51.0,"dim":80.5,"dt":"H","color":"Gray"},{"box":"Box 2","fold":51.0,"dim":57.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":53.0,"dim":73.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":37.0,"dim":97.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":61.0,"dim":74.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":47.0,"dim":77.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":75.0,"dim":65.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":42.0,"dim":86.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":47.0,"dim":85.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":35.0,"dim":114.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":38.0,"dim":86.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":36.0,"dim":102.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":37.0,"dim":95.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":46.0,"dim":89.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":41.0,"dim":96.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":61.0,"dim":51.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":51.0,"dim":88.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":47.0,"dim":80.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":45.0,"dim":78.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":98.0,"dim":84.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":47.0,"dim":85.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":58.0,"dim":74.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":101.0,"dim":63.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":89.0,"dim":87.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":51.0,"dim":88.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":46.0,"dim":81.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":37.0,"dim":99.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":41.0,"dim":93.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":40.0,"dim":98.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":71.0,"dim":93.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":41.0,"dim":91.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":89.0,"dim":86.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":41.0,"dim":85.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":50.0,"dim":60.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":34.0,"dim":91.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":49.0,"dim":60.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":77.0,"dim":36.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":77.0,"dim":85.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":36.0,"dim":96.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":41.0,"dim":89.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":39.0,"dim":49.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":33.0,"dim":93.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":48.0,"dim":104.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":47.0,"dim":98.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":62.0,"dim":90.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":51.0,"dim":185.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":57.0,"dim":51.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":42.0,"dim":71.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":45.0,"dim":87.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":52.0,"dim":92.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":36.0,"dim":109.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":44.0,"dim":104.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":31.0,"dim":73.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":30.0,"dim":126.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":49.0,"dim":91.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":70.0,"dim":86.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":75.0,"dim":107.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":60.0,"dim":101.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":52.0,"dim":97.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":34.0,"dim":104.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":44.0,"dim":99.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":60.0,"dim":88.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":60.0,"dim":103.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":67.0,"dim":89.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":60.0,"dim":47.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":47.0,"dim":92.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":94.0,"dim":68.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":49.0,"dim":92.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":43.0,"dim":105.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":41.0,"dim":92.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":93.0,"dim":50.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":61.0,"dim":60.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":126.0,"dim":74.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":88.0,"dim":96.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":61.0,"dim":36.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":49.0,"dim":93.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":45.0,"dim":89.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":47.0,"dim":94.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":47.0,"dim":96.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":50.0,"dim":92.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":55.0,"dim":43.0,"dt":"H","color":"Gray"},{"box":"Box 2","fold":30.0,"dim":106.0,"dt":"H","color":"Gray"},{"box":"Box 4","fold":59.0,"dim":115.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":71.0,"dim":89.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":75.0,"dim":91.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":77.0,"dim":89.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":8.0,"dim":87.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":49.0,"dim":78.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":65.0,"dim":76.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":71.0,"dim":90.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":79.0,"dim":40.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":44.0,"dim":91.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":42.0,"dim":65.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":42.0,"dim":92.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":42.0,"dim":83.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":112.0,"dim":96.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":89.0,"dim":95.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":75.0,"dim":36.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":47.0,"dim":94.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":65.0,"dim":53.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":85.0,"dim":76.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":62.0,"dim":67.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":40.0,"dim":64.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":49.0,"dim":103.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":42.0,"dim":96.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":71.0,"dim":95.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":141.0,"dim":65.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":144.0,"dim":64.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":75.0,"dim":65.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":60.0,"dim":75.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":84.0,"dim":75.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":74.0,"dim":38.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":83.0,"dim":74.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":80.0,"dim":95.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":59.0,"dim":74.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":64.0,"dim":95.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":87.0,"dim":97.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":72.0,"dim":81.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":92.0,"dim":92.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":153.0,"dim":96.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":42.0,"dim":97.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":95.0,"dim":75.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":87.0,"dim":91.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":83.0,"dim":76.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":94.0,"dim":91.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":74.0,"dim":90.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":122.0,"dim":76.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":59.0,"dim":61.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":36.0,"dim":116.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":60.0,"dim":61.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":35.0,"dim":97.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":38.0,"dim":47.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":42.0,"dim":96.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":60.0,"dim":75.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":61.0,"dim":68.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":153.0,"dim":65.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":57.0,"dim":83.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":63.0,"dim":62.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":48.0,"dim":83.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":64.0,"dim":60.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":44.0,"dim":62.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":61.0,"dim":71.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":49.0,"dim":83.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":81.0,"dim":85.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":49.0,"dim":80.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":53.0,"dim":94.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":44.0,"dim":87.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":41.0,"dim":62.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":59.0,"dim":80.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":47.0,"dim":87.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":33.0,"dim":44.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":30.0,"dim":94.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":32.0,"dim":70.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":52.0,"dim":82.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":43.0,"dim":94.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":81.0,"dim":189.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":48.0,"dim":300.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":119.0,"dim":52.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":154.0,"dim":64.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":92.0,"dim":97.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":22.0,"dim":91.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":49.0,"dim":97.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":100.0,"dim":69.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":81.0,"dim":81.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":95.0,"dim":97.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":76.0,"dim":188.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":53.0,"dim":105.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":55.0,"dim":43.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":32.0,"dim":54.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":41.0,"dim":71.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":41.0,"dim":80.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":43.0,"dim":94.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":81.0,"dim":102.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":51.0,"dim":93.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":27.0,"dim":85.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":47.0,"dim":86.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":89.0,"dim":205.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":34.0,"dim":60.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":31.0,"dim":70.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":41.0,"dim":101.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":46.0,"dim":66.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":50.0,"dim":79.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":35.0,"dim":97.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":41.0,"dim":103.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":38.0,"dim":103.0,"dt":"H","color":"Black"},{"box":"Box 4","fold":38.0,"dim":95.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":80.0,"dim":86.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":129.0,"dim":94.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":58.0,"dim":291.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":32.0,"dim":300.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":31.0,"dim":500.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":58.0,"dim":102.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":88.0,"dim":70.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":58.0,"dim":102.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":78.0,"dim":90.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":93.0,"dim":83.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":60.0,"dim":62.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":41.0,"dim":77.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":46.0,"dim":86.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":86.0,"dim":89.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":45.0,"dim":78.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":47.0,"dim":88.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":89.0,"dim":55.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":49.0,"dim":95.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":155.0,"dim":60.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":48.0,"dim":108.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":59.0,"dim":203.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":67.0,"dim":96.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":87.0,"dim":62.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":48.0,"dim":89.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":62.0,"dim":52.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":42.0,"dim":81.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":31.0,"dim":71.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":50.0,"dim":77.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":48.0,"dim":90.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":54.0,"dim":87.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":38.0,"dim":97.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":49.0,"dim":91.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":46.0,"dim":106.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":31.0,"dim":133.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":25.0,"dim":131.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":47.0,"dim":76.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":27.0,"dim":124.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":75.0,"dim":96.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":58.0,"dim":41.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":28.0,"dim":128.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":24.0,"dim":128.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":32.0,"dim":47.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":42.0,"dim":88.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":21.0,"dim":118.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":27.0,"dim":88.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":21.0,"dim":105.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":36.0,"dim":91.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":38.0,"dim":98.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":40.0,"dim":108.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":23.0,"dim":113.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":42.0,"dim":112.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":42.0,"dim":96.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":22.0,"dim":43.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":37.0,"dim":300.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":32.0,"dim":178.0,"dt":"H","color":"Black"},{"box":"Box 5","fold":30.0,"dim":148.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":54.0,"dim":213.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":40.0,"dim":300.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":29.0,"dim":85.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":92.0,"dim":50.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":24.0,"dim":140.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":37.0,"dim":103.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":81.0,"dim":80.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":30.0,"dim":145.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":50.0,"dim":189.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":54.0,"dim":94.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":38.0,"dim":115.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":34.0,"dim":180.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":69.0,"dim":89.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":95.0,"dim":65.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":29.0,"dim":59.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":47.0,"dim":45.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":55.0,"dim":84.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":26.0,"dim":127.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":27.0,"dim":145.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":25.0,"dim":132.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":44.0,"dim":186.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":30.0,"dim":75.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":32.0,"dim":177.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":30.0,"dim":300.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":32.0,"dim":105.0,"dt":"W","color":"Black Mesh"},{"box":"Box 5","fold":31.0,"dim":50.0,"dt":"W","color":"Black Mesh"},{"box":"Box 6","fold":68.0,"dim":78.6,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":40.0,"dim":62.5,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":48.0,"dim":91.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":63.0,"dim":79.5,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":51.0,"dim":89.5,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":41.0,"dim":98.5,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":42.0,"dim":82.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":34.0,"dim":62.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":32.0,"dim":94.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":41.0,"dim":86.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":43.0,"dim":90.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":45.0,"dim":91.4,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":44.0,"dim":63.5,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":70.0,"dim":79.5,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":79.0,"dim":95.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":79.0,"dim":102.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":59.0,"dim":69.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":60.0,"dim":73.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":24.0,"dim":107.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":45.0,"dim":82.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":70.0,"dim":75.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":31.0,"dim":50.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":37.0,"dim":76.5,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":41.0,"dim":193.7,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":62.0,"dim":72.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":38.0,"dim":69.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":45.0,"dim":86.5,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":54.0,"dim":76.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":50.0,"dim":86.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":50.0,"dim":77.8,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":37.0,"dim":89.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":83.0,"dim":93.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":81.0,"dim":70.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":29.0,"dim":97.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":49.0,"dim":90.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":31.0,"dim":129.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":73.0,"dim":79.5,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":129.0,"dim":69.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":38.0,"dim":91.6,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":31.0,"dim":115.3,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":40.0,"dim":235.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":62.0,"dim":97.5,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":44.0,"dim":91.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":36.0,"dim":195.5,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":29.0,"dim":77.5,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":35.0,"dim":73.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":89.0,"dim":79.5,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":60.0,"dim":67.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":48.0,"dim":90.8,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":50.0,"dim":74.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":59.0,"dim":74.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":44.0,"dim":75.0,"dt":"H","color":"Black Mesh"},{"box":"Box 6","fold":40.0,"dim":93.0,"dt":"H","color":"Black Mesh"}];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var STOCK = [];       // active stock array (uploaded or builtin)
var usedKeys = new Set();
var stockSource = 'builtin'; // 'builtin' | 'uploaded'

function stockKey(s){ return s.box+'|'+s.color+'|'+s.fold+'|'+s.dim+'|'+s.dt; }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PERSISTENT STORAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadState(){
  try{
    // Load uploaded stock (if any)
    var sr = await window.storage.get('pleated-stock-data');
    if(sr && sr.value){
      var parsed = JSON.parse(sr.value);
      if(Array.isArray(parsed) && parsed.length>0){
        STOCK = parsed; stockSource='uploaded';
      }
    }
    if(!STOCK.length){ STOCK = BUILTIN_STOCK.slice(); stockSource='builtin'; }
  }catch(e){ STOCK = BUILTIN_STOCK.slice(); }

  try{
    var ur = await window.storage.get('pleated-used-stock');
    if(ur && ur.value){ usedKeys = new Set(JSON.parse(ur.value)); }
  }catch(e){ usedKeys = new Set(); }
}

async function saveUsed(){
  try{ await window.storage.set('pleated-used-stock', JSON.stringify([...usedKeys])); }catch(e){}
}

async function saveStock(arr){
  try{ await window.storage.set('pleated-stock-data', JSON.stringify(arr)); }catch(e){}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EXCEL UPLOAD (using SheetJS from CDN)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function triggerUpload(){ document.getElementById('file_input').click(); }
function dragOver(e){ e.preventDefault(); document.getElementById('upload_zone').classList.add('drag'); }
function dragLeave(e){ document.getElementById('upload_zone').classList.remove('drag'); }
function dropFile(e){
  e.preventDefault();
  document.getElementById('upload_zone').classList.remove('drag');
  var file = e.dataTransfer.files[0];
  if(file) processExcelFile(file);
}
function handleFile(e){ if(e.target.files[0]) processExcelFile(e.target.files[0]); }

function processExcelFile(file){
  var res = document.getElementById('upload_result');
  res.style.display='block'; res.className='upload-result';
  res.textContent = 'Reading file‚Ä¶';

  var reader = new FileReader();
  reader.onload = function(e){
    try{
      var data = new Uint8Array(e.target.result);
      var wb   = XLSX.read(data, {type:'array'});
      var items = [];

      wb.SheetNames.forEach(function(sheetName){
        if(sheetName === 'SUMMARY') return;
        var ws   = wb.Sheets[sheetName];
        var rows = XLSX.utils.sheet_to_json(ws, {header:1, defval:''});
        if(rows.length < 3) return;

        // Detect color and dim type from sheet name
        var sn = sheetName.toLowerCase();
        var color = sn.includes('gray') ? 'Gray' : (sn.includes('black mesh') ? 'Black Mesh' : 'Black');
        // Detect dim type from header row (row index 1)
        var hdr = (rows[1]||[]).map(function(h){ return String(h).toLowerCase(); });
        var dimType = hdr.some(function(h){ return h.includes('height'); }) ? 'H' : 'W';

        for(var i=2; i<rows.length; i++){
          var r = rows[i];
          var box  = String(r[0]||'').trim();
          var fold = parseFloat(r[1]);
          var dim  = parseFloat(r[2]);
          if(box && !isNaN(fold) && !isNaN(dim) && fold>0 && dim>0){
            items.push({box:box, fold:fold, dim:dim, dt:dimType, color:color});
          }
        }
      });

      if(items.length === 0){
        res.className='upload-result error';
        res.textContent = '‚ö†Ô∏è No valid stock data found. Make sure your Excel has the same format as mesh_inventory.xlsx (sheets: Box1 Gray Mesh, Box4 Black, etc.)';
        return;
      }

      STOCK = items; stockSource='uploaded';
      saveStock(items);
      // Reset used keys since new stock was loaded
      usedKeys = new Set(); saveUsed();

      res.className='upload-result';
      res.textContent = '‚úÖ Loaded '+items.length+' stock items from "'+file.name+'"';
      updateBoxFilter();
      renderStockList();
      updateStockPanelVisibility();
      compute();

    }catch(err){
      res.className='upload-result error';
      res.textContent = '‚ùå Error reading file: '+err.message;
    }
  };
  reader.readAsArrayBuffer(file);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STOCK LIST MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openStockModal(){
  document.getElementById('modal_overlay').classList.remove('hidden');
  updateBoxFilter();
  renderStockList();
  refreshStats();
}
function closeStockModal(){
  document.getElementById('modal_overlay').classList.add('hidden');
}
// Close on overlay click
document.getElementById('modal_overlay').addEventListener('click', function(e){
  if(e.target === this) closeStockModal();
});

function updateBoxFilter(){
  var boxes = [...new Set(STOCK.map(function(s){ return s.box; }))].sort();
  var sel = document.getElementById('sl_box');
  var cur = sel.value;
  sel.innerHTML = '<option value="">All</option>';
  boxes.forEach(function(b){
    var o = document.createElement('option');
    o.value = b; o.textContent = b;
    sel.appendChild(o);
  });
  sel.value = cur;
}

function updateStockPanelVisibility(){
  var hasStock = STOCK.length > 0;
  document.getElementById('stats_row').style.display    = hasStock ? '' : 'none';
  document.getElementById('sl_filters').style.display   = hasStock ? '' : 'none';
  document.getElementById('sl_table_wrap').style.display= hasStock ? '' : 'none';
  document.getElementById('no_stock_banner').style.display = hasStock ? 'none' : '';
}

function refreshStats(){
  var total = STOCK.length;
  var usedCount = STOCK.filter(function(s){ return usedKeys.has(stockKey(s)); }).length;
  document.getElementById('stat_total').textContent = total;
  document.getElementById('stat_avail').textContent = total - usedCount;
  document.getElementById('stat_used').textContent  = usedCount;
  updateStockPanelVisibility();
}

function renderStockList(){
  refreshStats();
  var colorF  = document.getElementById('sl_color').value;
  var statusF = document.getElementById('sl_status').value;
  var boxF    = document.getElementById('sl_box').value;
  var search  = (document.getElementById('sl_search').value||'').toLowerCase();

  var filtered = STOCK.filter(function(s, i){
    if(colorF  && s.color !== colorF) return false;
    if(boxF    && s.box   !== boxF)   return false;
    if(statusF){
      var isUsed = usedKeys.has(stockKey(s));
      if(statusF==='used'      && !isUsed) return false;
      if(statusF==='available' &&  isUsed) return false;
    }
    if(search){
      var txt = (s.box+s.color+s.fold+s.dim).toLowerCase();
      if(!txt.includes(search)) return false;
    }
    return true;
  });

  var html = '';
  filtered.forEach(function(s, fi){
    var k     = stockKey(s).replace(/'/g,"\\'");
    var isUsed= usedKeys.has(stockKey(s));
    var rowCls= isUsed ? 'used-row' : 'avail-row';
    var statusTxt = isUsed ? 'üî¥ Used' : 'üü¢ Available';
    var btnCls    = isUsed ? 'btn-toggle-use unmark' : 'btn-toggle-use mark';
    var btnTxt    = isUsed ? '‚Ü© Restore' : '‚úì Mark Used';
    html += '<tr class="'+rowCls+'">'
      +'<td style="color:#475569">'+(fi+1)+'</td>'
      +'<td>'+s.box+'</td>'
      +'<td>'+s.color+'</td>'
      +'<td style="color:#64748b">'+s.dt+'</td>'
      +'<td class="right mono">'+s.fold+'</td>'
      +'<td class="right mono">'+s.dim+'</td>'
      +'<td class="status-cell">'+statusTxt+'</td>'
      +'<td><button class="'+btnCls+'" onclick="toggleUsed(\''+k+'\')">'+btnTxt+'</button></td>'
      +'</tr>';
  });
  if(!html) html = '<tr><td colspan="8" style="text-align:center;padding:18px;color:#64748b">No items match the current filters.</td></tr>';
  document.getElementById('sl_tbody').innerHTML = html;
}

function toggleUsed(key){
  if(usedKeys.has(key)){ usedKeys.delete(key); }
  else { usedKeys.add(key); }
  saveUsed();
  renderStockList();
  // Refresh the suggestion panel too
  var w=+document.getElementById('width_mm').value||0, h=+document.getElementById('height_mm').value||0;
  if(w&&h) buildStockTable(Math.round(w/20),(h-40)/10,document.getElementById('mesh_color').value);
}

function markAllFilteredUsed(){
  var colorF = document.getElementById('sl_color').value;
  var boxF   = document.getElementById('sl_box').value;
  STOCK.filter(function(s){
    if(colorF && s.color!==colorF) return false;
    if(boxF   && s.box!==boxF)     return false;
    return true;
  }).forEach(function(s){ usedKeys.add(stockKey(s)); });
  saveUsed(); renderStockList();
  var w=+document.getElementById('width_mm').value||0, h=+document.getElementById('height_mm').value||0;
  if(w&&h) buildStockTable(Math.round(w/20),(h-40)/10,document.getElementById('mesh_color').value);
}

function clearAllUsed(){
  if(!confirm('Restore ALL items as available?')) return;
  usedKeys.clear(); saveUsed(); renderStockList();
  var w=+document.getElementById('width_mm').value||0, h=+document.getElementById('height_mm').value||0;
  if(w&&h) buildStockTable(Math.round(w/20),(h-40)/10,document.getElementById('mesh_color').value);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STOCK MATCH (suggestion panel)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function buildStockTable(needFold, needHcm, meshColor){
  var colorMap = {'Black':'Black','Gray':'Gray','Charcoal':'Black'};
  var sel = colorMap[meshColor]||meshColor;

  var badge   = document.getElementById('stock_badge');
  var tbody   = document.getElementById('stock_tbody');
  var needRow = document.getElementById('need_row');

  needRow.innerHTML='Need: fold ‚â• <span>'+needFold+'</span> &nbsp;|&nbsp; H ‚â• <span>'+needHcm.toFixed(1)+' cm</span> &nbsp;|&nbsp; Color: <span>'+sel+'</span>';

  var allFit = STOCK.filter(function(s){
    return s.dt==='H' && s.fold>=needFold && s.dim>=needHcm && !usedKeys.has(stockKey(s));
  });
  var colorMatch = allFit.filter(function(s){ return s.color===sel; });

  function byWaste(a,b){
    var df=(a.fold-needFold)-(b.fold-needFold); return df||((a.dim-needHcm)-(b.dim-needHcm));
  }
  colorMatch.sort(byWaste); allFit.sort(byWaste);

  var exact = colorMatch.filter(function(s){ return (s.fold-needFold)===0 && (s.dim-needHcm)<1; });

  var toShow, isAlt, isFallback;
  if(exact.length){
    toShow=exact.slice(0,5); isAlt=false; isFallback=false;
    badge.textContent='‚úÖ '+exact.length+' exact'; badge.className='stock-badge ok';
  } else if(colorMatch.length){
    toShow=colorMatch.slice(0,5); isAlt=true; isFallback=false;
    badge.textContent='‚ö†Ô∏è '+toShow.length+' alt ('+sel+')'; badge.className='stock-badge alt';
  } else if(allFit.length){
    toShow=allFit.slice(0,5); isAlt=true; isFallback=true;
    badge.textContent='‚ö†Ô∏è No '+sel+' ‚Äî '+toShow.length+' other'; badge.className='stock-badge none';
  } else {
    badge.textContent='‚ùå No Stock'; badge.className='stock-badge none';
    tbody.innerHTML='<tr><td colspan="8" class="no-match-msg">‚ùå No available stock meets requirements.'+(usedKeys.size?' <a href="#" onclick="openStockModal();return false" style="color:#38BDF8">View used items ‚Üí</a>':'')+'</td></tr>';
    return;
  }

  var rows='';
  if(isFallback) rows+='<tr><td colspan="8" class="alt-msg">‚ö†Ô∏è No <strong>'+sel+'</strong> stock. Showing other colors:</td></tr>';
  else if(isAlt) rows+='<tr><td colspan="8" class="alt-msg">No exact match ‚Äî closest <strong>'+sel+'</strong> alternatives:</td></tr>';

  toShow.forEach(function(s){
    var sf=s.fold-needFold, sh=(s.dim-needHcm).toFixed(1);
    var isEx=!isAlt&&sf===0&&parseFloat(sh)<1;
    var cls=isEx?'match-exact':(!isFallback?'match-alt-good':'match-alt-other');
    var lbl=isEx?'‚úÖ Exact':(!isFallback?'üîÑ Alt':'üîÑ '+s.color);
    var k=stockKey(s).replace(/'/g,"\\'");
    rows+='<tr class="'+cls+'">'
      +'<td><strong>'+s.box+'</strong></td><td>'+s.color+'</td>'
      +'<td class="right mono">'+s.fold+'</td><td class="right mono">'+s.dim+'</td>'
      +'<td class="right"><span class="surplus-chip'+(isAlt?' alt-chip':'')+'">'+(sf>=0?'+':'')+sf+'</span></td>'
      +'<td class="right"><span class="surplus-chip'+(isAlt?' alt-chip':'')+'">'+(parseFloat(sh)>=0?'+':'')+sh+'</span></td>'
      +'<td>'+lbl+'</td>'
      +'<td><button class="btn-use" onclick="markUsedFromSuggestion(\''+k+'\')">‚úì Used</button></td>'
      +'</tr>';
  });
  tbody.innerHTML=rows;
}

function markUsedFromSuggestion(key){
  usedKeys.add(key); saveUsed();
  var w=+document.getElementById('width_mm').value||0, h=+document.getElementById('height_mm').value||0;
  if(w&&h) buildStockTable(Math.round(w/20),(h-40)/10,document.getElementById('mesh_color').value);
  refreshStats();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CALCULATOR HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function holesByHeight(h){ return h<=1000?4:h<=2000?6:h<=2500?8:h<=3000?10:12; }
function escalate(n){ return n===4?6:n===6?8:n===8?10:n===10?12:12; }

function setNotesHighlight(on){
  var i=document.getElementById('notes'),o=document.getElementById('out_notes');
  if(!i||!o)return;
  var row=i.closest?i.closest('.row'):i.parentElement;
  if(on){i.classList.add('note-on');if(row)row.classList.add('note-row-on');o.className='mono note-badge';}
  else{i.classList.remove('note-on');if(row)row.classList.remove('note-row-on');o.className='mono';}
}
function setPowderHighlight(on){
  var i=document.getElementById('powder_code'),o=document.getElementById('out_powder');
  if(!i||!o)return;
  var row=i.closest?i.closest('.row'):i.parentElement;
  if(on){i.classList.add('pc-on');o.className='mono pc-badge';if(row)row.classList.add('pc-row-on');}
  else{i.classList.remove('pc-on');o.className='mono';if(row)row.classList.remove('pc-row-on');}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAIN COMPUTE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function compute(){
  var dir=document.getElementById('direction').value;
  var w=+document.getElementById('width_mm').value||0;
  var h=+document.getElementById('height_mm').value||0;
  var meshColor=document.getElementById('mesh_color').value;
  var powder=document.getElementById('powder_code').value.trim();
  var notes=document.getElementById('notes').value.trim();
  var repairOnly=(document.getElementById('replacement').value==='repair');

  document.getElementById('big_mode_header').textContent=(dir==='One Way')?'ONE WAY PLEATED SCREEN':'TWO WAY PLEATED SCREEN';
  document.getElementById('out_client').textContent=document.getElementById('client').value.trim()||'‚Äî';
  document.getElementById('out_branch').textContent=document.getElementById('branch').value;
  document.getElementById('out_size').textContent=w&&h?w+' √ó '+h:'‚Äî';
  document.getElementById('out_mesh_color').textContent=meshColor;
  document.getElementById('mesh_color_cell').textContent=meshColor;
  document.getElementById('out_accessories').textContent=document.getElementById('acc_color').value||'‚Äî';
  document.getElementById('out_notes').textContent=notes||'‚Äî';
  document.getElementById('out_powder').textContent=powder?'Yes ('+powder+')':'No';
  setNotesHighlight(!!notes); setPowderHighlight(!!powder);

  var cb=document.getElementById('cuttings_block');
  if(cb) cb.style.display=repairOnly?'none':'';

  if(!w||!h){
    ['len_side_frame','len_top_profile','len_pvc','len_bottom_profile','len_inner_frame','len_middle_profile','mesh_h_value','mesh_fold_value'].forEach(function(id){var el=document.getElementById(id);if(el)el.textContent='‚Äî';});
    document.getElementById('holes_table').innerHTML='';
    document.getElementById('rope_table').innerHTML='';
    document.getElementById('need_row').textContent='Enter width & height to see matches';
    document.getElementById('stock_badge').textContent='‚Äî';
    document.getElementById('stock_badge').className='stock-badge';
    document.getElementById('stock_tbody').innerHTML='';
    return;
  }

  document.getElementById('len_side_frame').textContent    =(h-51).toLocaleString();
  document.getElementById('len_top_profile').textContent   =(w-51).toLocaleString();
  document.getElementById('len_pvc').textContent           =(h-40).toLocaleString();
  document.getElementById('len_bottom_profile').textContent=(w-51).toLocaleString();
  document.getElementById('len_inner_frame').textContent   =(h-40).toLocaleString();
  document.getElementById('len_middle_profile').textContent=(h-100).toLocaleString();

  var meshH=h-40, meshFold=Math.round(w/20);
  document.getElementById('mesh_h_value').textContent  =meshH.toLocaleString();
  document.getElementById('mesh_fold_value').textContent=meshFold.toLocaleString();

  var perLeaf=(dir==='Two Way')?Math.round(meshFold/2):null;
  document.getElementById('mesh_fold_total_row').style.display =(dir==='Two Way')?'none':'';
  document.getElementById('mesh_fold_left_row').style.display  =(dir==='Two Way')?'':'none';
  document.getElementById('mesh_fold_right_row').style.display =(dir==='Two Way')?'':'none';
  document.getElementById('mesh_fold_per_leaf_row').style.display=(dir==='Two Way')?'':'none';
  if(perLeaf!=null){
    document.getElementById('mesh_fold_left_value').textContent =perLeaf.toLocaleString();
    document.getElementById('mesh_fold_right_value').textContent=perLeaf.toLocaleString();
    document.getElementById('mesh_fold_per_leaf_value').textContent=perLeaf.toLocaleString();
  }

  var holes=holesByHeight(h), gapOf=function(n){return(meshH-60)/(n-1);}, gap=gapOf(holes);
  while(gap>350&&holes<12){holes=escalate(holes);gap=gapOf(holes);}
  var hb=document.getElementById('holes_table'); hb.innerHTML=''; var pos=30;
  for(var i=1;i<=holes;i++){var tr=document.createElement('tr');tr.innerHTML='<td>'+i+'</td><td class="right mono">'+Math.round(pos)+'</td>';hb.appendChild(tr);pos+=gap;}

  var maxR=Math.min(Math.floor(holes/2),6), fr=w+h+300, qty=(dir==='One Way')?2:4;
  var rb=document.getElementById('rope_table'); rb.innerHTML='';
  for(var j=0;j<maxR;j++){var t2=document.createElement('tr');t2.innerHTML='<td>'+(j+1)+'</td><td class="right mono">'+Math.round(fr-j*gap).toLocaleString()+'</td><td class="right mono">'+qty+'</td>';rb.appendChild(t2);}

  buildStockTable(meshFold, meshH/10, meshColor);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BIND & INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
['direction','width_mm','height_mm','mesh_color','acc_color','replacement','powder_code','client','branch','notes'].forEach(function(id){
  var el=document.getElementById(id); if(!el)return;
  el.addEventListener((el.tagName==='SELECT'||el.tagName==='TEXTAREA')?'change':'input', compute);
});
document.getElementById('compute_btn').addEventListener('click',compute);

document.addEventListener('DOMContentLoaded', function(){
  // Load SheetJS dynamically
  var s=document.createElement('script');
  s.src='https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js';
  document.head.appendChild(s);

  loadState().then(function(){
    updateBoxFilter();
    updateStockPanelVisibility();
    compute();
  });
});

document.getElementById('powder_code').addEventListener('input',function(){setPowderHighlight(!!(this.value||'').trim());});
document.getElementById('notes').addEventListener('input',function(){setNotesHighlight(!!(this.value||'').trim());});
</script>
</body>
</html>
